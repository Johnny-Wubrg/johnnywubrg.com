---
const { id } = Astro.props;

function makeid(length: number) {
    var result           = '';
    var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    var charactersLength = characters.length;
    for ( var i = 0; i < length; i++ ) {
        result += characters.charAt(Math.floor(Math.random() * charactersLength));
    }
    return result;
}

const elementId = `moxfield-frame-${makeid(5)}`;
---

<iframe
  src=`https://moxfield.com/embed/${id}`
  id={elementId}
  width="100%"
  onload="moxfieldOnLoad(event)"></iframe>

<script is:inline>
  function moxfieldOnMessage(e) {
    const t = e.data;
    if ('object' == typeof t && 'moxfield' === t.type) {
      const e = document.getElementById(t.id);
      e && (e.style.height = t.data + 'px');
    }
  }
  function moxfieldOnLoad(e) {
    e.target &&
      e.target.contentWindow &&
      e.target.contentWindow.postMessage(
        { type: 'moxfield', data: e.target.id },
        '*'
      );
  }
  window.addEventListener('message', moxfieldOnMessage);
</script>

